---
summary: 'WhatsApp (web channel) integration: login, inbox, replies, media, and ops'
read_when:
  - Working on WhatsApp/web channel behavior or inbox routing
---
# WhatsAppï¼ˆç½‘é¡µæ¸ é“ï¼‰


çŠ¶æ€ï¼šä»…é€šè¿‡ Baileys ä½¿ç”¨ WhatsApp Webã€‚ç½‘å…³æ‹¥æœ‰ä¼šè¯ã€‚

## å¿«é€Ÿè®¾ç½®ï¼ˆåˆå­¦è€…ï¼‰
1ï¼‰å¦‚æœå¯èƒ½ï¼Œä½¿ç”¨**ç‹¬ç«‹çš„æ‰‹æœºå·ç **ï¼ˆæ¨èï¼‰ã€‚
2ï¼‰åœ¨ `~/.openclaw/openclaw.json` ä¸­é…ç½® WhatsAppã€‚
3ï¼‰è¿è¡Œ `openclaw channels login` æ‰«æäºŒç»´ç ï¼ˆå·²é“¾æ¥è®¾å¤‡ï¼‰ã€‚
4ï¼‰å¯åŠ¨ç½‘å…³ã€‚

æœ€å°é…ç½®ï¼š
```json5
{
  channels: {
    whatsapp: {
      dmPolicy: "allowlist",
      allowFrom: ["+15551234567"]
    }
  }
}
```

## ç›®æ ‡
- åœ¨ä¸€ä¸ªç½‘å…³è¿›ç¨‹ä¸­æ”¯æŒå¤šä¸ª WhatsApp è´¦æˆ·ï¼ˆå¤šè´¦æˆ·ï¼‰ã€‚
- ç¡®å®šæ€§è·¯ç”±ï¼šå›å¤è¿”å›åˆ° WhatsAppï¼Œä¸è¿›è¡Œæ¨¡å‹è·¯ç”±ã€‚
- æ¨¡å‹èƒ½å¤Ÿè·å¾—è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä»¥ç†è§£å¼•ç”¨å›å¤ã€‚

## é…ç½®å†™å…¥
é»˜è®¤æƒ…å†µä¸‹ï¼ŒWhatsApp å…è®¸åœ¨ `/config set|unset` è§¦å‘æ—¶å†™å…¥é…ç½®æ›´æ–°ï¼ˆéœ€è¦ `commands.config: true`ï¼‰ã€‚

ç¦ç”¨æ–¹æ³•ï¼š
```json5
{
  channels: { whatsapp: { configWrites: false } }
}
```

## æ¶æ„ï¼ˆå„æ–¹èŒè´£ï¼‰
- **ç½‘å…³**è´Ÿè´£ç®¡ç† Baileys å¥—æ¥å­—å’Œæ”¶ä»¶ç®±å¾ªç¯ã€‚
- **CLI / macOS åº”ç”¨ç¨‹åº**ä¸ç½‘å…³é€šä¿¡ï¼›ä¸ç›´æ¥ä½¿ç”¨ Baileysã€‚
- å‘é€æ¶ˆæ¯æ—¶éœ€è¦**æ´»è·ƒç›‘å¬å™¨**ï¼›å¦åˆ™å‘é€ä¼šè¿…é€Ÿå¤±è´¥ã€‚

## è·å–æ‰‹æœºå·ç ï¼ˆä¸¤ç§æ¨¡å¼ï¼‰

WhatsApp éœ€è¦çœŸå®çš„æ‰‹æœºå·ç è¿›è¡ŒéªŒè¯ã€‚VoIP å’Œè™šæ‹Ÿå·ç é€šå¸¸ä¼šè¢«é˜»æ­¢ã€‚åœ¨ WhatsApp ä¸Šè¿è¡Œ OpenClaw æœ‰ä¸¤ç§å—æ”¯æŒçš„æ–¹å¼ï¼š

### ä¸“ç”¨å·ç ï¼ˆæ¨èï¼‰
ä¸º OpenClaw ä½¿ç”¨**ç‹¬ç«‹çš„æ‰‹æœºå·ç **ã€‚ç”¨æˆ·ä½“éªŒæœ€ä½³ï¼Œè·¯ç”±æ¸…æ™°ï¼Œä¸å­˜åœ¨è‡ªèŠæ€ªç™–ã€‚ç†æƒ³è®¾ç½®ï¼š**å¤‡ç”¨/æ—§ Android æ‰‹æœº + eSIM**ã€‚å°†å…¶ä¿æŒåœ¨ Wiâ€‘Fi å’Œç”µæºè¿æ¥çŠ¶æ€ï¼Œå¹¶é€šè¿‡ QR ç è¿›è¡Œç»‘å®šã€‚

**WhatsApp Businessï¼š** æ‚¨å¯ä»¥åœ¨åŒä¸€è®¾å¤‡ä¸Šä½¿ç”¨ä¸åŒçš„å·ç è¿è¡Œ WhatsApp Businessã€‚è¿™éå¸¸é€‚åˆå°†æ‚¨çš„ä¸ªäºº WhatsApp ä¸å·¥ä½œåˆ†å¼€â€”â€”å®‰è£… WhatsApp Business å¹¶åœ¨é‚£é‡Œæ³¨å†Œ OpenClaw å·ç ã€‚

**ä¸“ç”¨å·ç å•ç”¨æˆ·ç™½åå•ç¤ºä¾‹é…ç½®ï¼š**
```json5
{
  channels: {
    whatsapp: {
      dmPolicy: "allowlist",
      allowFrom: ["+15551234567"]
    }
  }
}
```

**é…å¯¹æ¨¡å¼ï¼ˆå¯é€‰ï¼‰ï¼š**
å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨é…å¯¹è€Œéç™½åå•ï¼Œè¯·å°† `channels.whatsapp.dmPolicy` è®¾ç½®ä¸º `pairing`ã€‚æœªçŸ¥å‘ä»¶äººä¼šæ”¶åˆ°é…å¯¹ä»£ç ï¼›æ‰¹å‡†æ–¹å¼ï¼š
`openclaw pairing approve whatsapp <code>`

### ä¸ªäººå·ç ï¼ˆå›é€€ï¼‰
å¿«é€Ÿå›é€€ï¼šåœ¨**æ‚¨è‡ªå·±çš„å·ç **ä¸Šè¿è¡Œ OpenClawã€‚é€šè¿‡ç»™è‡ªå·±å‘é€æ¶ˆæ¯ï¼ˆWhatsAppâ€œç»™è‡ªå·±å‘æ¶ˆæ¯â€ï¼‰è¿›è¡Œæµ‹è¯•ï¼Œä»¥å…å‘è”ç³»äººå‘é€åƒåœ¾ä¿¡æ¯ã€‚åœ¨è®¾ç½®å’Œå®éªŒæœŸé—´ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨ä¸»æ‰‹æœºä¸ŠæŸ¥çœ‹éªŒè¯ç ã€‚**å¿…é¡»å¯ç”¨è‡ªèŠæ¨¡å¼ã€‚**

å½“å‘å¯¼è¯¢é—®æ‚¨çš„ä¸ªäºº WhatsApp å·ç æ—¶ï¼Œè¯·è¾“å…¥æ‚¨å°†ç”¨äºå‘é€æ¶ˆæ¯çš„ç”µè¯å·ç ï¼ˆæ‰€æœ‰è€…/å‘é€è€…ï¼‰ï¼Œè€Œä¸æ˜¯åŠ©æ‰‹å·ç ã€‚

**ä¸ªäººå·ç è‡ªèŠæ¨¡å¼ç¤ºä¾‹é…ç½®ï¼š**
```json
{
  "whatsapp": {
    "selfChatMode": true,
    "dmPolicy": "allowlist",
    "allowFrom": ["+15551234567"]
  }
}
```

è‡ªèŠå›å¤åœ¨è®¾ç½®æ—¶é»˜è®¤ä¸º `[{identity.name}]`ï¼ˆå¦åˆ™ä¸º `[openclaw]`)ï¼Œå¦‚æœ `messages.responsePrefix` æœªè®¾ç½®ã€‚æ˜¾å¼è®¾ç½®ä»¥è‡ªå®šä¹‰æˆ–ç¦ç”¨å‰ç¼€ï¼ˆä½¿ç”¨ `""` å¯ç§»é™¤å‰ç¼€ï¼‰ã€‚

### è·å–å·ç æç¤º
- **æœ¬åœ° eSIM**æ¥è‡ªæ‚¨æ‰€åœ¨å›½å®¶çš„ç§»åŠ¨è¿è¥å•†ï¼ˆæœ€å¯é ï¼‰
  - å¥¥åœ°åˆ©ï¼š[hot.at](https://www.hot.at)
  - è‹±å›½ï¼š[giffgaff](https://www.giffgaff.com) â€” å…è´¹ SIMï¼Œæ— åˆçº¦
- **é¢„ä»˜è´¹ SIM**â€” ä¾¿å®œï¼Œåªéœ€æ¥æ”¶ä¸€æ¡çŸ­ä¿¡å³å¯å®ŒæˆéªŒè¯

**é¿å…ï¼š** TextNowã€Google Voice å’Œå¤§å¤šæ•°â€œå…è´¹ SMSâ€æœåŠ¡â€”â€”WhatsApp å¯¹è¿™äº›æœåŠ¡é‡‡å–äº†ä¸¥æ ¼çš„å°é”æªæ–½ã€‚

**æç¤ºï¼š** å·ç åªéœ€æ¥æ”¶ä¸€æ¡éªŒè¯çŸ­ä¿¡ã€‚ä¹‹åï¼ŒWhatsApp Web ä¼šè¯å¯é€šè¿‡ `creds.json` æŒç»­å­˜åœ¨ã€‚

## ä¸ºä»€ä¹ˆä¸ç”¨ Twilioï¼Ÿ
- æ—©æœŸçš„ OpenClaw ç‰ˆæœ¬æ”¯æŒ Twilio çš„ WhatsApp Business é›†æˆã€‚
- WhatsApp Business å·ç å¹¶ä¸é€‚åˆä¸ªäººåŠ©ç†ã€‚
- Meta å¼ºåˆ¶æ‰§è¡Œ 24 å°æ—¶å›å¤çª—å£ï¼›å¦‚æœæ‚¨åœ¨è¿‡å» 24 å°æ—¶å†…æœªå›å¤ï¼Œè¯¥å•†ä¸šå·ç å°†æ— æ³•å‘èµ·æ–°æ¶ˆæ¯ã€‚
- é«˜æµé‡æˆ–â€œèŠå¤©å¼â€ä½¿ç”¨ä¼šè§¦å‘ä¸¥å‰çš„å°é”ï¼Œå› ä¸ºå•†ä¸šè´¦æˆ·å¹¶éè®¾è®¡ç”¨äºå‘é€æ•°åæ¡ä¸ªäººåŠ©ç†æ¶ˆæ¯ã€‚
- ç»“æœï¼šäº¤ä»˜ä¸å¯é ä¸”é¢‘ç¹è¢«å°é”ï¼Œå› æ­¤å·²å–æ¶ˆå¯¹è¯¥åŠŸèƒ½çš„æ”¯æŒã€‚

## ç™»å½• + å‡­æ®
- ç™»å½•å‘½ä»¤ï¼š`openclaw channels login`ï¼ˆé€šè¿‡å·²é“¾æ¥è®¾å¤‡æ‰«æ QR ç ï¼‰ã€‚
- å¤šè´¦æˆ·ç™»å½•ï¼š`openclaw channels login --account <id>`ï¼ˆ`<id>` = `accountId`ï¼‰ã€‚
- é»˜è®¤è´¦æˆ·ï¼ˆå½“ `--account` æœªæŒ‡å®šæ—¶ï¼‰ï¼šå¦‚æœæœ‰ `default`ï¼Œåˆ™ä½¿ç”¨è¯¥è´¦æˆ·ï¼›å¦åˆ™ä½¿ç”¨ç¬¬ä¸€ä¸ªå·²é…ç½®è´¦æˆ· IDï¼ˆæŒ‰æ’åºé¡ºåºï¼‰ã€‚
- å‡­æ®å­˜å‚¨åœ¨ `~/.openclaw/credentials/whatsapp/<accountId>/creds.json` ä¸­ã€‚
- å¤‡ä»½å‰¯æœ¬ä½äº `creds.json.bak`ï¼ˆåœ¨æŸåæ—¶æ¢å¤ï¼‰ã€‚
- æ—§ç‰ˆå…¼å®¹æ€§ï¼šè¾ƒæ—©ç‰ˆæœ¬çš„å®‰è£…ä¼šå°† Baileys æ–‡ä»¶ç›´æ¥å­˜å‚¨åœ¨ `~/.openclaw/credentials/` ä¸­ã€‚
- æ³¨é”€ï¼š`openclaw channels logout`ï¼ˆæˆ– `--account <id>`ï¼‰ä¼šåˆ é™¤ WhatsApp è®¤è¯çŠ¶æ€ï¼ˆä½†ä¿ç•™å…±äº«çš„ `oauth.json`ï¼‰ã€‚
- æ³¨é”€åçš„å¥—æ¥å­—ä¼šå¼•å‘é”™è¯¯ï¼Œæç¤ºé‡æ–°é“¾æ¥ã€‚

## å…¥ç«™æµç¨‹ï¼ˆç§ä¿¡ + ç¾¤ç»„ï¼‰
- WhatsApp äº‹ä»¶æ¥è‡ª `messages.upsert`ï¼ˆBaileysï¼‰ã€‚
- æ”¶ä»¶ç®±ç›‘å¬å™¨åœ¨å…³é—­æ—¶ä¼šæ–­å¼€ï¼Œä»¥é¿å…åœ¨æµ‹è¯•/é‡å¯ä¸­ç´¯ç§¯äº‹ä»¶å¤„ç†ç¨‹åºã€‚
- çŠ¶æ€/å¹¿æ’­èŠå¤©ä¼šè¢«å¿½ç•¥ã€‚
- ç›´æ¥èŠå¤©ä½¿ç”¨ E.164 æ ¼å¼ï¼›ç¾¤ç»„ä½¿ç”¨ç¾¤ç»„ JIDã€‚
- **ç§ä¿¡ç­–ç•¥**ï¼š`channels.whatsapp.dmPolicy` æ§åˆ¶ç›´æ¥èŠå¤©çš„è®¿é—®æƒé™ï¼ˆé»˜è®¤ï¼š`pairing`ï¼‰ã€‚
  - é…ç€ï¼šæœªçŸ¥å‘ä»¶äººä¼šæ”¶åˆ°é…ç€ä»£ç ï¼ˆé€šè¿‡ `openclaw pairing approve whatsapp <code>` æ‰¹å‡†ï¼›ä»£ç  1 å°æ—¶åå¤±æ•ˆï¼‰ã€‚
  - å¼€æ”¾ï¼šéœ€è¦ `channels.whatsapp.allowFrom` åŒ…æ‹¬ `"*"`ã€‚
  - æ‚¨å·²é“¾æ¥çš„ WhatsApp å·ç è¢«è§†ä¸ºéšå«ä¿¡ä»»ï¼Œå› æ­¤è‡ªæ¶ˆæ¯ä¼šè·³è¿‡ `channels.whatsapp.dmPolicy` å’Œ `channels.whatsapp.allowFrom` æ£€æŸ¥ã€‚

### ä¸ªäººå·ç æ¨¡å¼ï¼ˆå›é€€ï¼‰
å¦‚æœæ‚¨åœ¨**ä¸ªäºº WhatsApp å·ç **ä¸Šè¿è¡Œ OpenClawï¼Œè¯·å¯ç”¨ `channels.whatsapp.selfChatMode`ï¼ˆè§ä¸Šæ–¹ç¤ºä¾‹ï¼‰ã€‚

è¡Œä¸ºï¼š
- å‡ºç«™ç§ä¿¡æ°¸è¿œä¸ä¼šè§¦å‘é…ç€å›å¤ï¼ˆé˜²æ­¢å‘è”ç³»äººå‘é€åƒåœ¾ä¿¡æ¯ï¼‰ã€‚
- å…¥ç«™æœªçŸ¥å‘ä»¶äººä»éµå¾ª `channels.whatsapp.dmPolicy`ã€‚
- è‡ªèŠæ¨¡å¼ï¼ˆallowFrom åŒ…æ‹¬æ‚¨çš„å·ç ï¼‰å¯é¿å…è‡ªåŠ¨è¯»å–å›æ‰§ï¼Œå¹¶å¿½ç•¥æåŠ JIDã€‚
- éè‡ªèŠç§ä¿¡ä¼šå‘é€è¯»å–å›æ‰§ã€‚

## è¯»å–å›æ‰§
é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘å…³ä¼šåœ¨æ¥å—å…¥ç«™ WhatsApp æ¶ˆæ¯åç«‹å³å°†å…¶æ ‡è®°ä¸ºå·²è¯»ï¼ˆæ˜¾ç¤ºè“å‹¾ï¼‰ã€‚

å…¨å±€ç¦ç”¨ï¼š
```json5
{
  channels: { whatsapp: { sendReadReceipts: false } }
}
```

æŒ‰è´¦æˆ·ç¦ç”¨ï¼š
```json5
{
  channels: {
    whatsapp: {
      accounts: {
        personal: { sendReadReceipts: false }
      }
    }
  }
}
```

æ³¨æ„ï¼š
- è‡ªèŠæ¨¡å¼å§‹ç»ˆè·³è¿‡è¯»å–å›æ‰§ã€‚

## WhatsApp å¸¸è§é—®é¢˜è§£ç­”ï¼šå‘é€æ¶ˆæ¯ + é…ç€

**å½“æˆ‘ç»‘å®š WhatsApp æ—¶ï¼ŒOpenClaw ä¼šéšæœºç»™è”ç³»äººå‘é€æ¶ˆæ¯å—ï¼Ÿ**  
ä¸ä¼šã€‚é»˜è®¤çš„ç§ä¿¡ç­–ç•¥æ˜¯**é…ç€**ï¼Œå› æ­¤æœªçŸ¥å‘ä»¶äººåªä¼šæ”¶åˆ°é…ç€ä»£ç ï¼Œä»–ä»¬çš„æ¶ˆæ¯**ä¸ä¼šè¢«å¤„ç†**ã€‚OpenClaw åªä¼šå›å¤å®ƒæ”¶åˆ°çš„èŠå¤©æ¶ˆæ¯ï¼Œæˆ–è€…æ‚¨æ˜ç¡®è§¦å‘çš„å‘é€ï¼ˆä»£ç†/CLIï¼‰ã€‚

**WhatsApp ä¸Šçš„é…ç€æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ**  
é…ç€æ˜¯é’ˆå¯¹æœªçŸ¥å‘ä»¶äººçš„ç§ä¿¡é—¨æ§ï¼š
- æ¥è‡ªæ–°å‘ä»¶äººçš„ç¬¬ä¸€æ¡ç§ä¿¡ä¼šè¿”å›ä¸€ä¸ªçŸ­ä»£ç ï¼ˆæ¶ˆæ¯ä¸ä¼šè¢«å¤„ç†ï¼‰ã€‚
- æ‰¹å‡†æ–¹å¼ï¼š`openclaw pairing approve whatsapp <code>`ï¼ˆé€šè¿‡ `openclaw pairing list whatsapp` åˆ—è¡¨æ‰¹å‡†ï¼‰ã€‚
- ä»£ç  1 å°æ—¶åå¤±æ•ˆï¼›æ¯ä¸ªé¢‘é“æœ€å¤šå…è®¸ 3 ä¸ªå¾…å¤„ç†è¯·æ±‚ã€‚

**æ˜¯å¦æœ‰å¤šä¸ªäººå¯ä»¥ä½¿ç”¨ä¸åŒçš„ OpenClaw å®ä¾‹åœ¨ä¸€ä¸ª WhatsApp å·ç ä¸Šï¼Ÿ**  
æ˜¯çš„ï¼Œå¯ä»¥é€šè¿‡ `bindings` å°†æ¯ä¸ªå‘ä»¶äººè·¯ç”±åˆ°ä¸åŒçš„ä»£ç†ï¼ˆpeer `kind: "dm"`ï¼Œå‘ä»¶äºº E.164 å¦‚ `+15551234567`)ã€‚å›å¤ä»ç„¶æ¥è‡ª**åŒä¸€ä¸ª WhatsApp è´¦æˆ·**ï¼Œç›´æ¥èŠå¤©ä¼šåˆå¹¶åˆ°æ¯ä¸ªä»£ç†çš„ä¸»è¦ä¼šè¯ä¸­ï¼Œå› æ­¤è¯·ä½¿ç”¨**æ¯äººä¸€ä¸ªä»£ç†**ã€‚ç§ä¿¡è®¿é—®æ§åˆ¶ï¼ˆ`dmPolicy`/`allowFrom`ï¼‰æ˜¯é’ˆå¯¹ WhatsApp è´¦æˆ·çš„å…¨å±€è®¾ç½®ã€‚è¯·å‚é˜… [å¤šä»£ç†è·¯ç”±](/concepts/multi-agent)ã€‚

**ä¸ºä»€ä¹ˆå‘å¯¼ä¼šè¦æ±‚æˆ‘çš„ç”µè¯å·ç ï¼Ÿ**  
å‘å¯¼ä½¿ç”¨å®ƒæ¥è®¾ç½®æ‚¨çš„**ç™½åå•/æ‰€æœ‰è€…**ï¼Œä»¥ä¾¿æ‚¨è‡ªå·±çš„ç§ä¿¡è¢«å…è®¸ã€‚å®ƒä¸ç”¨äºè‡ªåŠ¨å‘é€ã€‚å¦‚æœæ‚¨åœ¨ä¸ªäºº WhatsApp å·ç ä¸Šè¿è¡Œï¼Œè¯·ä½¿ç”¨è¯¥å·ç å¹¶å¯ç”¨ `channels.whatsapp.selfChatMode`ã€‚

## æ¶ˆæ¯è§„èŒƒåŒ–ï¼ˆæ¨¡å‹çœ‹åˆ°çš„å†…å®¹ï¼‰
- `Body` æ˜¯å½“å‰å¸¦æœ‰ä¿¡å°çš„æ¶ˆæ¯æ­£æ–‡ã€‚
- å¼•ç”¨å›å¤ä¸Šä¸‹æ–‡**å§‹ç»ˆé™„åŠ **ï¼š
  ```
  [Replying to +1555 id:ABC123]
  <quoted text or <media:...>>
  [/Replying]
  ```
- å›å¤å…ƒæ•°æ®ä¹Ÿä¸€å¹¶è®¾ç½®ï¼š
  - `ReplyToId` = stanzaId
  - `ReplyToBody` = å¼•ç”¨æ­£æ–‡æˆ–åª’ä½“å ä½ç¬¦
  - `ReplyToSender` = å·²çŸ¥æ—¶çš„ E.164
- ä»…åŒ…å«åª’ä½“çš„å…¥ç«™æ¶ˆæ¯ä½¿ç”¨å ä½ç¬¦ï¼š
  - `<media:image|video|audio|document|sticker>`

## ç¾¤ç»„
- ç¾¤ç»„æ˜ å°„åˆ° `agent:<agentId>:whatsapp:group:<jid>` ä¼šè¯ã€‚
- ç¾¤ç»„æ”¿ç­–ï¼š`channels.whatsapp.groupPolicy = open|disabled|allowlist`ï¼ˆé»˜è®¤ `allowlist`ï¼‰ã€‚
- æ¿€æ´»æ¨¡å¼ï¼š
  - `mention`ï¼ˆé»˜è®¤ï¼‰ï¼šéœ€è¦ @æåŠæˆ–æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚
  - `always`ï¼šå§‹ç»ˆè§¦å‘ã€‚
- `/activation mention|always` ä»…ä¾›æ‰€æœ‰è€…ä½¿ç”¨ï¼Œå¿…é¡»ä½œä¸ºç‹¬ç«‹æ¶ˆæ¯å‘é€ã€‚
- æ‰€æœ‰è€… = `channels.whatsapp.allowFrom`ï¼ˆæˆ–å¦‚æœªè®¾ç½®åˆ™ä¸ºè‡ª E.164ï¼‰ã€‚
- **å†å²æ³¨å…¥**ï¼ˆä»…é™å¾…å¤„ç†æ¶ˆæ¯ï¼‰ï¼š
  - æœ€è¿‘ *æœªå¤„ç†* çš„æ¶ˆæ¯ï¼ˆé»˜è®¤ 50 æ¡ï¼‰æ’å…¥ä»¥ä¸‹å†…å®¹ï¼š
    `[Chat messages since your last reply - for context]`ï¼ˆä¼šè¯ä¸­å·²æœ‰çš„æ¶ˆæ¯ä¸ä¼šå†æ¬¡æ³¨å…¥ï¼‰
  - å½“å‰æ¶ˆæ¯æ’å…¥ä»¥ä¸‹å†…å®¹ï¼š
    `[Current message - respond to this]`
  - å‘ä»¶äººåç¼€é™„åŠ ï¼š`[from: Name (+E164)]`
- ç¾¤ç»„å…ƒæ•°æ®ç¼“å­˜ 5 åˆ†é’Ÿï¼ˆä¸»é¢˜ + å‚ä¸è€…ï¼‰ã€‚

## å›å¤ä¼ é€’ï¼ˆçº¿ç¨‹åŒ–ï¼‰
- WhatsApp Web å‘é€æ ‡å‡†æ¶ˆæ¯ï¼ˆå½“å‰ç½‘å…³ä¸æ”¯æŒå¼•ç”¨å›å¤çº¿ç¨‹åŒ–ï¼‰ã€‚
- åœ¨æ­¤æ¸ é“ä¸Šå¿½ç•¥å›å¤æ ‡ç­¾ã€‚

## ç¡®è®¤ååº”ï¼ˆæ”¶åˆ°æ¶ˆæ¯åè‡ªåŠ¨ååº”ï¼‰

WhatsApp å¯ä»¥åœ¨æ”¶åˆ°ä¼ å…¥æ¶ˆæ¯åç«‹å³è‡ªåŠ¨å‘é€è¡¨æƒ…ç¬¦å·ååº”ï¼Œåœ¨æœºå™¨äººç”Ÿæˆå›å¤ä¹‹å‰æä¾›å³æ—¶åé¦ˆï¼Œè®©ç”¨æˆ·çŸ¥é“ä»–ä»¬çš„æ¶ˆæ¯å·²è¢«æ¥æ”¶ã€‚

**é…ç½®ï¼š**
```json
{
  "whatsapp": {
    "ackReaction": {
      "emoji": "ğŸ‘€",
      "direct": true,
      "group": "mentions"
    }
  }
}
```

**é€‰é¡¹ï¼š**
- `emoji`ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼šç”¨äºç¡®è®¤çš„è¡¨æƒ…ç¬¦å·ï¼ˆä¾‹å¦‚ï¼Œâ€œğŸ‘€â€ã€â€œâœ…â€ã€â€œğŸ“¨â€ï¼‰ã€‚ç©ºå€¼æˆ–æœªè®¾ç½® = åŠŸèƒ½ç¦ç”¨ã€‚
- `direct`ï¼ˆå¸ƒå°”å€¼ï¼Œé»˜è®¤ä¸º `true`ï¼‰ï¼šåœ¨ç›´æ¥/ç§ä¿¡èŠå¤©ä¸­å‘é€ååº”ã€‚
- `group`ï¼ˆå­—ç¬¦ä¸²ï¼Œé»˜è®¤ä¸º `"mentions"`ï¼‰ï¼šç¾¤ç»„èŠå¤©è¡Œä¸ºï¼š
  - `"always"`ï¼šå¯¹æ‰€æœ‰ç¾¤ç»„æ¶ˆæ¯ä½œå‡ºååº”ï¼ˆå³ä½¿æ²¡æœ‰ @æåŠï¼‰
  - `"mentions"`ï¼šä»…åœ¨æœºå™¨äººè¢« @æåŠæ—¶æ‰ä½œå‡ºååº”
  - `"never"`ï¼šä»ä¸åœ¨ç¾¤ç»„ä¸­ä½œå‡ºååº”

**æŒ‰è´¦æˆ·è¦†ç›–ï¼š**
```json
{
  "whatsapp": {
    "accounts": {
      "work": {
        "ackReaction": {
          "emoji": "âœ…",
          "direct": false,
          "group": "always"
        }
      }
    }
  }
}
```

**è¡Œä¸ºè¯´æ˜ï¼š**
- ååº”åœ¨æ¶ˆæ¯æ”¶åˆ°**ç«‹å³**å‘é€ï¼Œæ—©äºæ‰“å­—æŒ‡ç¤ºå™¨æˆ–æœºå™¨äººå›å¤ã€‚
- åœ¨å…·æœ‰ `requireMention: false`ï¼ˆæ¿€æ´»ï¼šå§‹ç»ˆï¼‰çš„ç¾¤ç»„ä¸­ï¼Œ`group: "mentions"` ä¼šå¯¹æ‰€æœ‰æ¶ˆæ¯ä½œå‡ºååº”ï¼ˆè€Œä¸ä»…ä»…æ˜¯ @æåŠï¼‰ã€‚
- ä¸€æ¬¡æ€§çš„ååº”å¤±è´¥ä¼šè¢«è®°å½•ï¼Œä½†ä¸ä¼šé˜»æ­¢æœºå™¨äººå›å¤ã€‚
- å‚ä¸è€… JID ä¼šè‡ªåŠ¨åŒ…å«åœ¨ç¾¤ç»„ååº”ä¸­ã€‚
- WhatsApp ä¼šå¿½ç•¥ `messages.ackReaction`ï¼›è¯·æ”¹ç”¨ `channels.whatsapp.ackReaction`ã€‚

## ä»£ç†å·¥å…·ï¼ˆååº”ï¼‰
- å·¥å…·ï¼š`whatsapp`ï¼Œå¸¦æœ‰ `react` æ“ä½œï¼ˆ`chatJid`ã€`messageId`ã€`emoji`ï¼Œå¯é€‰ `remove`ï¼‰ã€‚
- å¯é€‰ï¼š`participant`ï¼ˆç¾¤ç»„å‘ä»¶äººï¼‰ã€`fromMe`ï¼ˆå¯¹è‡ªå·±æ¶ˆæ¯ä½œå‡ºååº”ï¼‰ã€`accountId`ï¼ˆå¤šè´¦æˆ·ï¼‰ã€‚
- ååº”ç§»é™¤è¯­ä¹‰ï¼šè¯·å‚é˜… [/tools/reactions](/tools/reactions)ã€‚
- å·¥å…·é—¨æ§ï¼š`channels.whatsapp.actions.reactions`ï¼ˆé»˜è®¤ï¼šå¯ç”¨ï¼‰ã€‚

## é™åˆ¶
- å‡ºç«™æ–‡æœ¬æŒ‰ `channels.whatsapp.textChunkLimit` åˆ†å—ï¼ˆé»˜è®¤ 4000 å­—ï¼‰ã€‚
- å¯é€‰æ¢è¡Œåˆ†å—ï¼šå°† `channels.whatsapp.chunkMode="newline"` è®¾ç½®ä¸ºåœ¨é•¿åº¦åˆ†å—ä¹‹å‰æŒ‰ç©ºè¡Œï¼ˆæ®µè½è¾¹ç•Œï¼‰è¿›è¡Œåˆ†å‰²ã€‚
- å…¥ç«™åª’ä½“ä¿å­˜ä¸Šé™ç”± `channels.whatsapp.mediaMaxMb` è®¾å®šï¼ˆé»˜è®¤ 50 MBï¼‰ã€‚
- å‡ºç«™åª’ä½“é¡¹ç›®ä¸Šé™ç”± `agents.defaults.mediaMaxMb` è®¾å®šï¼ˆé»˜è®¤ 5 MBï¼‰ã€‚

## å‡ºç«™å‘é€ï¼ˆæ–‡æœ¬ + åª’ä½“ï¼‰
- ä½¿ç”¨æ´»è·ƒçš„ç½‘é¡µç›‘å¬å™¨ï¼›å¦‚æœç½‘å…³æœªè¿è¡Œï¼Œåˆ™ä¼šå‡ºé”™ã€‚
- æ–‡æœ¬åˆ†å—ï¼šæ¯æ¡æ¶ˆæ¯æœ€å¤š 4k å­—ï¼ˆå¯é€šè¿‡ `channels.whatsapp.textChunkLimit` è¿›è¡Œé…ç½®ï¼Œå¯é€‰ `channels.whatsapp.chunkMode`ï¼‰ã€‚
- åª’ä½“ï¼š
  - æ”¯æŒå›¾åƒ/è§†é¢‘/éŸ³é¢‘/æ–‡æ¡£ã€‚
  - éŸ³é¢‘ä»¥ PTT å½¢å¼å‘é€ï¼›`audio/ogg` => `audio/ogg; codecs=opus`ã€‚
  - ä»…åœ¨ç¬¬ä¸€ä»¶åª’ä½“ä¸Šæ·»åŠ è¯´æ˜ã€‚
  - åª’ä½“è·å–æ”¯æŒ HTTP(S) å’Œæœ¬åœ°è·¯å¾„ã€‚
  - åŠ¨ç”» GIFï¼šWhatsApp æœŸæœ› MP4 æ ¼å¼ï¼Œå¹¶ä½¿ç”¨ `gifPlayback: true` å®ç°å†…è”å¾ªç¯ã€‚
    - CLIï¼š`openclaw message send --media <mp4> --gif-playback`
    - ç½‘å…³ï¼š`send` å‚æ•°åŒ…æ‹¬ `gifPlayback: true`

## è¯­éŸ³ç¬”è®°ï¼ˆPTT éŸ³é¢‘ï¼‰
WhatsApp ä»¥**è¯­éŸ³ç¬”è®°**ï¼ˆPTT æ°”æ³¡ï¼‰çš„å½¢å¼å‘é€éŸ³é¢‘ã€‚
- æœ€ä½³æ•ˆæœï¼šOGG/Opusã€‚OpenClaw ä¼šå°† `audio/ogg` é‡å†™ä¸º `audio/ogg; codecs=opus`ã€‚
- `[[audio_as_voice]]` å¯¹ WhatsApp æ— æ•ˆï¼ˆéŸ³é¢‘å·²ç»ä»¥è¯­éŸ³ç¬”è®°å½¢å¼å‘é€ï¼‰ã€‚

## åª’ä½“é™åˆ¶ + ä¼˜åŒ–
- é»˜è®¤å‡ºç«™ä¸Šé™ï¼š5 MBï¼ˆæ¯ä»¶åª’ä½“ï¼‰ã€‚
- è¦†ç›–ï¼š`agents.defaults.mediaMaxMb`ã€‚
- å›¾ç‰‡åœ¨ä¸Šé™èŒƒå›´å†…ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸º JPEGï¼ˆè°ƒæ•´å¤§å° + è´¨é‡æ‰«æï¼‰ã€‚
- è¶…å¤§åª’ä½“ä¼šå¯¼è‡´é”™è¯¯ï¼›åª’ä½“å›å¤ä¼šå›è½ä¸ºæ–‡æœ¬è­¦å‘Šã€‚

## å¿ƒè·³
- **ç½‘å…³å¿ƒè·³**è®°å½•è¿æ¥å¥åº·çŠ¶å†µï¼ˆ`web.heartbeatSeconds`ï¼Œé»˜è®¤ 60 ç§’ï¼‰ã€‚
- **ä»£ç†å¿ƒè·³**å¯ä»¥æŒ‰ä»£ç†é…ç½®ï¼ˆ`agents.list[].heartbeat`ï¼‰æˆ–é€šè¿‡ `agents.defaults.heartbeat` è¿›è¡Œå…¨å±€é…ç½®ï¼ˆå½“æœªè®¾ç½®ä»£ç†ç‰¹å®šæ¡ç›®æ—¶çš„å›é€€ï¼‰ã€‚
  - ä½¿ç”¨é…ç½®çš„å¿ƒè·³æç¤ºï¼ˆé»˜è®¤ï¼š`Read HEARTBEAT.md if it exists (workspace context). Follow it strictly. Do not infer or repeat old tasks from prior chats. If nothing needs attention, reply HEARTBEAT_OK.`ï¼‰+ `HEARTBEAT_OK` è·³è¿‡è¡Œä¸ºã€‚
  - äº¤ä»˜é»˜è®¤ä¸ºæœ€åä½¿ç”¨çš„æ¸ é“ï¼ˆæˆ–é…ç½®çš„ç›®æ ‡ï¼‰ã€‚

## é‡æ–°è¿æ¥è¡Œä¸º
- é€€é¿ç­–ç•¥ï¼š`web.reconnect`ï¼š
  - `initialMs`ã€`maxMs`ã€`factor`ã€`jitter`ã€`maxAttempts`ã€‚
- å¦‚æœè¾¾åˆ°æœ€å¤§å°è¯•æ¬¡æ•°ï¼Œç½‘é¡µç›‘æ§å°†åœæ­¢ï¼ˆæ€§èƒ½ä¸‹é™ï¼‰ã€‚
- æ³¨é”€ => åœæ­¢å¹¶è¦æ±‚é‡æ–°é“¾æ¥ã€‚

## é…ç½®å¿«é€Ÿåœ°å›¾
- `channels.whatsapp.dmPolicy`ï¼ˆç§ä¿¡ç­–ç•¥ï¼šé…ç€/ç™½åå•/å¼€æ”¾/ç¦ç”¨ï¼‰ã€‚
- `channels.whatsapp.selfChatMode`ï¼ˆåŒæ‰‹æœºè®¾ç½®ï¼›æœºå™¨äººä½¿ç”¨æ‚¨çš„ä¸ªäºº WhatsApp å·ç ï¼‰ã€‚
- `channels.whatsapp.allowFrom`ï¼ˆç§ä¿¡ç™½åå•ï¼‰ã€‚WhatsApp ä½¿ç”¨ E.164 ç”µè¯å·ç ï¼ˆæ— ç”¨æˆ·åï¼‰ã€‚
- `channels.whatsapp.mediaMaxMb`ï¼ˆå…¥ç«™åª’ä½“ä¿å­˜ä¸Šé™ï¼‰ã€‚
- `channels.whatsapp.ackReaction`ï¼ˆæ”¶åˆ°æ¶ˆæ¯æ—¶è‡ªåŠ¨ååº”ï¼š`{emoji, direct, group}`ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.*`ï¼ˆæŒ‰è´¦æˆ·è®¾ç½® + å¯é€‰ `authDir`ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.mediaMaxMb`ï¼ˆæŒ‰è´¦æˆ·å…¥ç«™åª’ä½“ä¸Šé™ï¼‰ã€‚
- `channels.whatsapp.accounts.<accountId>.ackReaction`ï¼ˆæŒ‰è´¦æˆ·ç¡®è®¤ååº”è¦†ç›–ï¼‰ã€‚
- `channels.whatsapp.groupAllowFrom`ï¼ˆç¾¤ç»„å‘ä»¶äººç™½åå•ï¼‰ã€‚
- `channels.whatsapp.groupPolicy`ï¼ˆç¾¤ç»„æ”¿ç­–ï¼‰ã€‚
- `channels.whatsapp.historyLimit` / `channels.whatsapp.accounts.<accountId>.historyLimit`ï¼ˆç¾¤ç»„å†å²ä¸Šä¸‹æ–‡ï¼›`0` å¯ç¦ç”¨ï¼‰ã€‚
- `channels.whatsapp.dmHistoryLimit`ï¼ˆä»¥ç”¨æˆ·å›åˆè®¡çš„ç§ä¿¡å†å²ä¸Šé™ï¼‰ã€‚æŒ‰ç”¨æˆ·è¦†ç›–ï¼š`channels.whatsapp.dms["<phone>"].historyLimit`ã€‚
- `channels.whatsapp.groups`ï¼ˆç¾¤ç»„ç™½åå• + æåŠé—¨æ§é»˜è®¤ï¼›ä½¿ç”¨ `"*"` å¯å…è®¸æ‰€æœ‰äººï¼‰ã€‚
- `channels.whatsapp.actions.reactions`ï¼ˆæ§åˆ¶ WhatsApp å·¥å…·ååº”ï¼‰ã€‚
- `agents.list[].groupChat.mentionPatterns`ï¼ˆæˆ– `messages.groupChat.mentionPatterns`ï¼‰ã€‚
- `messages.groupChat.historyLimit`ã€‚
- `channels.whatsapp.messagePrefix`ï¼ˆå…¥ç«™å‰ç¼€ï¼›æŒ‰è´¦æˆ·ï¼š`channels.whatsapp.accounts.<accountId>.messagePrefix`ï¼›å·²å¼ƒç”¨ï¼š`messages.messagePrefix`ï¼‰ã€‚
- `messages.responsePrefix`ï¼ˆå‡ºç«™å‰ç¼€ï¼‰ã€‚
- `agents.defaults.mediaMaxMb`ã€‚
- `agents.defaults.heartbeat.every`ã€‚
- `agents.defaults.heartbeat.model`ï¼ˆå¯é€‰è¦†ç›–ï¼‰ã€‚
- `agents.defaults.heartbeat.target`ã€‚
- `agents.defaults.heartbeat.to`ã€‚
- `agents.defaults.heartbeat.session`ã€‚
- `agents.list[].heartbeat.*`ï¼ˆæŒ‰ä»£ç†è¦†ç›–ï¼‰ã€‚
- `session.*`ï¼ˆèŒƒå›´ã€é—²ç½®ã€å­˜å‚¨ã€mainKeyï¼‰ã€‚
- `web.enabled`ï¼ˆå½“ä¸ºå‡æ—¶ç¦ç”¨é€šé“å¯åŠ¨ï¼‰ã€‚
- `web.heartbeatSeconds`ã€‚
- `web.reconnect.*`ã€‚

## æ—¥å¿— + æ•…éšœæ’é™¤
- å­ç³»ç»Ÿï¼š`whatsapp/inbound`ã€`whatsapp/outbound`ã€`web-heartbeat`ã€`web-reconnect`ã€‚
- æ—¥å¿—æ–‡ä»¶ï¼š`/tmp/openclaw/openclaw-YYYY-MM-DD.log`ï¼ˆå¯é…ç½®ï¼‰ã€‚
- æ•…éšœæ’é™¤æŒ‡å—ï¼š[ç½‘å…³æ•…éšœæ’é™¤](/gateway/troubleshooting)ã€‚

## æ•…éšœæ’é™¤ï¼ˆå¿«é€Ÿï¼‰

**æœªé“¾æ¥ / éœ€è¦ QR ç™»å½•**
- ç—‡çŠ¶ï¼š`channels status` æ˜¾ç¤º `linked: false` æˆ–è­¦å‘Šâ€œæœªé“¾æ¥â€ã€‚
- è§£å†³æ³•ï¼šåœ¨ç½‘å…³ä¸»æœºä¸Šè¿è¡Œ `openclaw channels login`ï¼Œå¹¶æ‰«æ QR ç ï¼ˆWhatsApp â†’ è®¾ç½® â†’ å·²é“¾æ¥è®¾å¤‡ï¼‰ã€‚

**å·²é“¾æ¥ä½†æ–­å¼€ / é‡æ–°è¿æ¥å¾ªç¯**
- ç—‡çŠ¶ï¼š`channels status` æ˜¾ç¤º `running, disconnected` æˆ–è­¦å‘Šâ€œå·²é“¾æ¥ä½†æ–­å¼€â€ã€‚
- è§£å†³æ³•ï¼š`openclaw doctor`ï¼ˆæˆ–é‡å¯ç½‘å…³ï¼‰ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œé€šè¿‡ `channels login` é‡æ–°é“¾æ¥ï¼Œå¹¶æ£€æŸ¥ `openclaw logs --follow`ã€‚

**Bun è¿è¡Œæ—¶**
- **ä¸æ¨èä½¿ç”¨ Bun**ã€‚WhatsAppï¼ˆBaileysï¼‰å’Œ Telegram åœ¨ Bun ä¸Šè¡¨ç°ä¸ç¨³å®šã€‚
  è¯·ä½¿ç”¨ **Node** è¿è¡Œç½‘å…³ã€‚ï¼ˆè¯·å‚é˜…å…¥é—¨è¿è¡Œæ—¶æ³¨æ„äº‹é¡¹ã€‚ï¼‰
